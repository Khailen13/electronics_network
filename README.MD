# Торговая сеть электроники

Django REST API для управления иерархической структурой торговой сети по продаже электроники.

## Технологии

- Python 3.8+
- Django 3+
- Django REST Framework 3.10+
- PostgreSQL 10+
- Poetry (управление зависимостями)

## Быстрый старт

### 1. Клонирование репозитория
```
git clone https://github.com/Khailen13/electronics_network.git
cd electronics_network
```
### 2. Установка зависимостей
```
poetry install
```
### 3. Настройка базы данных
```
cp .env.example .env
# Отредактируйте .env файл (укажите параметры PostgreSQL)
```
### 4. Применение миграций
```
poetry run python manage.py migrate
```
### 5. Создание суперпользователя
```
poetry run python manage.py createsuperuser
```
### 6. Запуск сервера
```
poetry run python manage.py runserver
```
### 7. Заполнение демо-данными (опционально)
```
python manage.py create_demo_data --count 20 --clear
# --count 20 - контролирует количество создаваемых несвязанных между собой сетей (по умолчанию 10 шт.)
# --clear - выполняет предварительную очистку базы данных
```
## Структура проекта
```
electronics_network/
├── network/                  # Основное приложение
│   ├── models.py             # Модели данных
│   ├── admin.py              # Конфигурация админ-панели
│   ├── serializers.py        # DRF сериализаторы
│   ├── views.py              # API представления
│   ├── filters.py            # Фильтры для API
│   ├── permissions.py        # Кастомные permissions
│   └── tests/                # Тесты
├── .env.example              # Шаблон переменных окружения
├── pyproject.toml            # Конфигурация Poetry
└── requirements.txt          # Список зависимостей
```
## Модели данных
### NetworkNode (Звено сети)
* **Типы звеньев:** Завод (factory), Розничная сеть (retail), ИП (entrepreneur)

* **Иерархия:** 3 уровня (0-2), определяется через поле supplier

* **Особые поля:**
  * supplier_debt - задолженность перед поставщиком в рублях, с точностью до копеек
  * level - автоматически вычисляемый уровень иерархии
  * created_at - время создания

### Contact (Контакты)
* Связано one-to-one с NetworkNode
* Содержит поля: email, страна, город, улица, дом

### Product (Продукты)
* Связано many-to-many с NetworkNode
* Содержит поля: название, модель, дата выхода на рынок

## Бизнес-логика
**Основные правила:**
* Максимальная глубина иерархии - 3 уровня
* Звенья типа завода всегда находятся на уровне 0, не могут иметь поставщика и имеют нулевую задолженность 
* Звенья типа розничной сети и индивидуального предпринимателя могут находиться на уровне 1 или 2
* У звеньев типа розничной сети и индивидуального предпринимателя должен быть поставщик
* Задолженность перед поставщиком нельзя изменить через API
* Звенья типа розничной сети и индивидуального предпринимателя могут продавать только те продукты, которые есть у поставщика
* Нельзя удалить продукт звена, если он требуется клиентам звена
* Изменить поставщика узла можно при соблюдении следующих условий:
  * задолженность равна нулю
  * у нового поставщика есть все продукты, необходимые существующим клиентам узла (при наличии клиентов)
  * изменение поставщика не приведет к превышению максимальной глубины иерархии
* Нельзя изменить тип звена на "завод" при наличии задолженности

## API Endpoints
### NetworkNode CRUD
```
GET    /api/network-nodes/          # Список всех звеньев
POST   /api/network-nodes/          # Создание нового звена
GET    /api/network-nodes/{id}/     # Детальная информация
PUT    /api/network-nodes/{id}/     # Полное обновление
PATCH  /api/network-nodes/{id}/     # Частичное обновление
DELETE /api/network-nodes/{id}/     # Удаление
```
### Фильтрация
```
GET /api/network-nodes/?country=Россия  # Фильтр по стране
```
### Аутентификация и права доступа
* Используется Session/Basic Authentication
* Только активные сотрудники имеют доступ к API
## Админ-панель
Доступна по адресу /admin/ после создания суперпользователя.

**Особенности:**
* Ссылка на поставщика - кликабельная ссылка на страницу звена сети и в общем списке
* Фильтр по городу - фильтрация объектов по названию города
* Admin Action - очистка задолженности для выбранных объектов
* Валидация - проверка целостности данных при сохранении
* Inline контактов - редактирование контактов на странице звена

## Тестирование
**Запуск всех тестов с покрытием:**
```
pytest
```
**Структура тестов:**
* `test_models.py` - тесты моделей и бизнес-логики
* `test_views.py` - тесты API endpoints
* `test_serializers.py` - тесты сериализаторов
* `test_admin.py` - тесты админ-панели
* `test_permissions.py` - тесты прав доступа

**Результаты тестирования**

Покрытие кода тестами составляет `84%`.
Отчет о покрытии будет располагаться в папке htmlcov после выполнения тестов.

## Лицензия
Проект создан в рамках тестового задания.


